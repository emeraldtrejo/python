#Here's your challenge: Write a script to generate two different reports based on the ranking of errors generated by the system and the user usage statistics for the service. 
#You'll write the script on your own, but we'll guide you throughout.
#First, import all the Python modules that you'll use in this Python script. 
#After importing the necessary modules, initialize two dictionaries: one for the number of different error messages and another to count the number of entries for each user (splitting between INFO and ERROR).
#Now, parse through each log entry in the syslog.log file by iterating over the file.
#For each log entry, you'll have to first check if it matches the INFO or ERROR message formats.
#You should use regular expressions for this. When you get a successful match, add one to the corresponding value in the per_user dictionary. 
#If you get an ERROR message, add one to the corresponding entry in the error dictionary by using proper data structure.
#After you've processed the log entries from the syslog.log file, you need to sort both the per_user and error dictionary before creating CSV report files.
#Keep in mind that:
#The error dictionary should be sorted by the number of errors from most common to least common.
#The user dictionary should be sorted by username.
#Insert column names as ("Error", "Count") at the zero index position of the sorted error dictionary. 
#And insert column names as ("Username", "INFO", "ERROR") at the zero index position of the sorted per_user dictionary.

#!/usr/bin/env python3
import re
import csv
import operator
import sys

per_user = {}
errors = {}

logfile = 'syslog.log'
f = open(logfile, 'r')

errorfile = 'error_message.csv'
userfile = 'user_statistics.csv'

for log in f:
        result = re.search(r"ticky: ([\w+]*):? ([\w' ]*) [\[[0-9#]*\]?]? ?\((.*)\)$", log)
        if result.group(2) not in errors.keys():
                errors[result.group(2)] = 0
        errors[result.group(2)] += 1
        if result.group(3) not in per_user.keys():
                per_user[result.group(3)] = {}
                per_user[result.group(3)]["INFO"] = 0
                per_user[result.group(3)]["ERROR"] = 0

        if result.group(1) == "INFO":
                per_user[result.group(3)]["INFO"] += 1
        elif result.group(1) == "ERROR":
                per_user[result.group(3)]["ERROR"] += 1

errors = sorted(errors.items(), key = operator.itemgetter(1), reverse = True)
per_user = sorted(per_user.items())

f.close()
errors.insert(0, ('Error', 'Count'))

f = open(errorfile, 'w')
for error in errors:
        a,b = error
        f.write(str(a)+','+str(b)+'\n')
f.close()

f = open(userfile, 'w')
f.write("Username,INFO,ERROR\n")
for stats in per_user:
        a, b = stats
        f.write(str(a)+','+str(b["INFO"])+','+str(b["ERROR"])+'\n')
